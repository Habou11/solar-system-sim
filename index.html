<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>íƒœì–‘ê³„ ì‹œë®¬ë ˆì´ì…˜</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body {
      margin: 0; overflow: hidden;
      background: black;
      color: white;
      font-family: 'Noto Sans', sans-serif, sans-serif;
      -webkit-user-select:none;
      -moz-user-select:none;
      -ms-user-select:none;
      user-select:none;
    }
    .ui-button {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 1000;
    }
    .ui-button button {
      padding: 10px 16px;
      font-size: 14px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      background: #eee;
      cursor: pointer;
      transition: background 0.2s;
      user-select:none;
    }
    .ui-button button:hover {
      background: #ccc;
    }
    .zoom-control {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1000;
      background: rgba(255,255,255,0.85);
      padding: 10px;
      border-radius: 10px;
      user-select:none;
    }
    .zoom-control button {
      margin: 4px 0;
      width: 36px;
      height: 36px;
      font-size: 20px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
    }
    .zoom-control input[type="range"] {
      writing-mode: bt-lr;
      -webkit-appearance: slider-vertical;
      width: 30px;
      height: 130px;
      margin: 8px 0;
    }
    /* ì •ë³´ì°½ ìŠ¤íƒ€ì¼ */
    #infoBox {
      position: fixed;
      top: 60px;
      left: 20px;
      width: 240px;
      background: rgba(255,255,255,0.95);
      color: black;
      border-radius: 10px;
      padding: 12px 16px 16px 16px;
      box-shadow: 0 0 15px rgba(255,255,255,0.3);
      user-select:none;
      cursor: default;
      z-index: 1100;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    #infoBox.show {
      opacity: 1;
      visibility: visible;
    }
    #infoBox h2 {
      margin: 0 0 8px 0;
      font-weight: 700;
      font-size: 18px;
    }
    #infoBox ul {
      padding-left: 18px;
      margin: 0;
      font-size: 14px;
      line-height: 1.3;
    }
    #infoBox ul li {
      margin-bottom: 6px;
    }
    /* ë°°ì† í‘œì‹œ ìŠ¤íƒ€ì¼ (ë…ë¦½) */
    #speedDisplay {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 14px;
      font-weight: bold;
      color: #333;
      background: rgba(255,255,255,0.85);
      padding: 6px 10px;
      border-radius: 5px;
      text-align: center;
      width: 80px;
      z-index: 1000;
    }
    /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
    .search-container {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }
    #planetSearchInput {
      padding: 8px 12px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background: rgba(255,255,255,0.85);
      color: #333;
      outline: none;
      width: 160px;
      user-select: text; /* ê²€ìƒ‰ì°½ í…ìŠ¤íŠ¸ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ ì¶”ê°€ */
    }
    #planetSearchInput::placeholder {
      color: #666;
    }
  </style>
</head>
<body>

<div class="ui-button">
  <button id="pauseBtn">â¸ ì •ì§€</button>
  <button id="slowBtn">ëŠë¦¬ê²Œ</button>
  <button id="fastBtn">ë¹ ë¥´ê²Œ</button>
</div>

<div class="zoom-control">
  <button id="zoomInBtn">ï¼‹</button>
  <input type="range" min="0.5" max="2" step="0.01" value="1" id="zoomSlider" />
  <button id="zoomOutBtn">âˆ’</button>
</div>

<span id="speedDisplay">ë°°ì†: x1.0</span>

<div class="search-container">
  <input type="text" id="planetSearchInput" placeholder="í–‰ì„± ì´ë¦„ ê²€ìƒ‰..." />
</div>

<div id="infoBox">
  <h2>í–‰ì„± ì •ë³´</h2>
  <ul id="infoContent"></ul>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<script>
let planets = [];
let stars = [];

let selectedPlanet = null; // ì„ íƒëœ í–‰ì„± ë˜ëŠ” ìœ„ì„±
let baseSpeed = 0.5;
let displaySpeed = 1;
let maxDisplaySpeed = 4;
let currentSpeed = baseSpeed;
let isPaused = false;

// ì¹´ë©”ë¼ ê´€ë ¨ ë³€ìˆ˜
let camX = 0;
let camY = 0;
let targetCamX = 0;
let targetCamY = 0;
let zoom = 1;
let targetZoom = 1;
let isFollowingPlanet = false; // í–‰ì„±(ë¶€ëª¨) ì¶”ì  ì¤‘ì¸ì§€ ì—¬ë¶€
let cameraEaseFactor = 0.08;
let defaultZoom = 1;
let focusedPlanetZoom = 2;

let infoBox = null;
let infoContent = null;
let speedDisplay = null;
let planetSearchInput = null;

let infoBoxX = 20, infoBoxY = 60;
let draggingInfo = false;
let dragOffsetX = 0, dragOffsetY = 0;

function setup() {
  createCanvas(windowWidth, windowHeight);
  angleMode(DEGREES);
  initPlanets();
  generateStars();

  infoBox = document.getElementById('infoBox');
  infoContent = document.getElementById('infoContent');
  speedDisplay = document.getElementById('speedDisplay');
  planetSearchInput = document.getElementById('planetSearchInput');

  // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
  document.getElementById('pauseBtn').addEventListener('click', togglePause);
  document.getElementById('slowBtn').addEventListener('click', () => adjustSpeed(-0.1));
  document.getElementById('fastBtn').addEventListener('click', () => adjustSpeed(0.1));
  document.getElementById('zoomInBtn').addEventListener('click', () => setZoom(defaultZoom * 1.1));
  document.getElementById('zoomOutBtn').addEventListener('click', () => setZoom(defaultZoom / 1.1));
  document.getElementById('zoomSlider').addEventListener('input', (e) => setZoom(parseFloat(e.target.value)));

  // í–‰ì„± ê²€ìƒ‰ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  planetSearchInput.addEventListener('input', (event) => {
      const query = event.target.value.toLowerCase().trim();
      let found = false;

      if (query === '') {
          closeInfoBox();
          return;
      }

      // í–‰ì„± ë¨¼ì € ê²€ìƒ‰
      for (let p of planets) {
          if (p.name.toLowerCase().includes(query)) {
              selectedPlanet = p;
              showInfoBox(p);
              isFollowingPlanet = true;
              found = true;
              break;
          }
      }

      // í–‰ì„±ì—ì„œ ëª» ì°¾ì•˜ìœ¼ë©´ ìœ„ì„± ê²€ìƒ‰
      if (!found) {
        for (let p of planets) {
            if (p.moons) {
                for (let m of p.moons) {
                    if (m.name.toLowerCase().includes(query)) {
                        selectedPlanet = m; // ìœ„ì„± ê°ì²´ë¥¼ selectedPlanetì— ì €ì¥
                        showInfoBox(m); // ìœ„ì„± ì •ë³´ í‘œì‹œ
                        isFollowingPlanet = false; // ìœ„ì„±ì€ íŒ”ë¡œìš°í•˜ì§€ ì•ŠìŒ
                        found = true;
                        break;
                    }
                }
            }
            if (found) break;
        }
      }

      if (!found) {
          closeInfoBox();
      }
  });

  // ë“œë˜ê·¸ ì‹œì‘
  infoBox.addEventListener('mousedown', infoMouseDown);
  window.addEventListener('mouseup', infoMouseUp);
  window.addEventListener('mousemove', infoMouseMove);

  // í„°ì¹˜ ì§€ì›
  infoBox.addEventListener('touchstart', infoTouchStart, {passive: false});
  window.addEventListener('touchend', infoTouchEnd);
  window.addEventListener('touchmove', infoTouchMove, {passive: false});

  updateSpeedDisplay();
}

function draw() {
  background(0);
  drawStars();

  // ì¹´ë©”ë¼ ì—…ë°ì´íŠ¸ ë¡œì§ (ì„ íƒëœ ê²ƒì´ í–‰ì„±ì´ë©´ íŒ”ë¡œìš°, ìœ„ì„±ì´ë©´ íŒ”ë¡œìš° ì•ˆ í•¨)
  if (isFollowingPlanet && selectedPlanet && !selectedPlanet.isMoon) {
    targetCamX = -selectedPlanet.x;
    targetCamY = -selectedPlanet.y;
    targetZoom = focusedPlanetZoom;
  } else {
    targetCamX = 0;
    targetCamY = 0;
    targetZoom = defaultZoom;
  }

  camX = lerp(camX, targetCamX, cameraEaseFactor);
  camY = lerp(camY, targetCamY, cameraEaseFactor);
  zoom = lerp(zoom, targetZoom, cameraEaseFactor);

  translate(width / 2 + camX * zoom, height / 2 + camY * zoom);
  scale(zoom);

  let targetSpeed = isPaused ? 0 : baseSpeed * displaySpeed;
  currentSpeed = lerp(currentSpeed, targetSpeed, 0.05);

  noFill();
  stroke(100, 150);
  strokeWeight(1);
  // í–‰ì„± ê¶¤ë„ ê·¸ë¦¬ê¸°
  for (let p of planets) {
    if (p.orbit > 0) ellipse(0, 0, p.orbit * 2);
  }

  // í–‰ì„± ê·¸ë¦¬ê¸°
  for (let p of planets) {
    if (p.orbit > 0) p.angle += p.speed * currentSpeed;
    let x = p.orbit === 0 ? 0 : cos(p.angle) * p.orbit;
    let y = p.orbit === 0 ? 0 : sin(p.angle) * p.orbit;
    p.x = x;
    p.y = y;

    // ----- í–‰ì„± ìì „ êµ¬í˜„ ì‹œì‘ -----
    push(); // í˜„ì¬ ë³€í™˜ ìƒíƒœ ì €ì¥
    translate(x, y); // í–‰ì„± ìœ„ì¹˜ë¡œ ì´ë™

    p.rotationAngle += p.rotationSpeed * currentSpeed; // ìì „ ê°ë„ ì—…ë°ì´íŠ¸
    rotate(p.rotationAngle); // í˜„ì¬ ìì „ ê°ë„ë§Œí¼ íšŒì „

    // í• ë¡œ íš¨ê³¼
    noStroke();
    for(let i=0; i<5; i++) {
      fill(p.color[0], p.color[1], p.color[2], 80 - i*15);
      ellipse(0, 0, p.size*2 + i*10); // ì¤‘ì‹¬ (0,0)ì—ì„œ ê·¸ë¦¬ê¸°
    }

    fill(p.color[0], p.color[1], p.color[2]);
    ellipse(0, 0, p.size * 2); // ì¤‘ì‹¬ (0,0)ì—ì„œ ê·¸ë¦¬ê¸°

    pop(); // ì´ì „ ë³€í™˜ ìƒíƒœ ë³µì›
    // ----- í–‰ì„± ìì „ êµ¬í˜„ ë -----

    fill(255);
    stroke(0);
    strokeWeight(3);
    textSize(12 / (zoom / defaultZoom));
    textAlign(CENTER);
    text(p.name, x, y - p.size - 8); // ì´ë¦„ì€ íšŒì „ê³¼ ë¬´ê´€í•˜ê²Œ ê³ ì •ëœ ìœ„ì¹˜ì—
    noStroke();

    // ìœ„ì„± ê·¸ë¦¬ê¸° (í–‰ì„±ì— ìœ„ì„±ì´ ìˆì„ ê²½ìš°)
    if (p.moons) {
      for (let m of p.moons) {
        m.angle += m.speed * currentSpeed;
        let moonX = p.x + cos(m.angle) * m.orbit;
        let moonY = p.y + sin(m.angle) * m.orbit;
        m.x = moonX;
        m.y = moonY;

        // ìœ„ì„± ê¶¤ë„ ê·¸ë¦¬ê¸° (ë¶€ëª¨ í–‰ì„± ì£¼ìœ„)
        noFill();
        stroke(100, 100);
        strokeWeight(0.5);
        ellipse(p.x, p.y, m.orbit * 2);

        // ----- ìœ„ì„± ìì „ êµ¬í˜„ ì‹œì‘ -----
        push(); // í˜„ì¬ ë³€í™˜ ìƒíƒœ ì €ì¥
        translate(moonX, moonY); // ìœ„ì„± ìœ„ì¹˜ë¡œ ì´ë™

        m.rotationAngle += m.rotationSpeed * currentSpeed; // ìì „ ê°ë„ ì—…ë°ì´íŠ¸
        rotate(m.rotationAngle); // í˜„ì¬ ìì „ ê°ë„ë§Œí¼ íšŒì „

        fill(m.color[0], m.color[1], m.color[2]);
        noStroke();
        ellipse(0, 0, m.size * 2); // ì¤‘ì‹¬ (0,0)ì—ì„œ ê·¸ë¦¬ê¸°

        pop(); // ì´ì „ ë³€í™˜ ìƒíƒœ ë³µì›
        // ----- ìœ„ì„± ìì „ êµ¬í˜„ ë -----

        fill(255);
        stroke(0);
        strokeWeight(1.5);
        textSize(8 / (zoom / defaultZoom));
        textAlign(CENTER);
        text(m.name, moonX, moonY - m.size - 5); // ì´ë¦„ì€ íšŒì „ê³¼ ë¬´ê´€í•˜ê²Œ ê³ ì •ëœ ìœ„ì¹˜ì—
        noStroke();
      }
    }
  }

  if (infoBox.classList.contains('show')) {
      infoBox.style.left = infoBoxX + 'px';
      infoBox.style.top = infoBoxY + 'px';
  }
}

function initPlanets() {
  planets = [];
  // íƒœì–‘ (ì¤‘ì‹¬)
  planets.push({
    name: "íƒœì–‘", orbit: 0, size: 50, speed: 0, angle: 0,
    color: [255, 220, 0],
    rotationAngle: random(360), rotationSpeed: 0.1, // íƒœì–‘ë„ ìì „
    info: {
      ë°˜ì§€ë¦„: "696,340 km",
      ì„±ë¶„: "ìˆ˜ì†Œ, í—¬ë¥¨",
      ëŒ€ê¸°: "ìˆìŒ",
      ìœ„ì„±: "ì—†ìŒ",
      ê¸°ì›: "Sol",
      ë°€ë„: "1.41 g/cmÂ³"
    }
  });

  const data = [
    { name: "ìˆ˜ì„±", orbit: 90, size: 6, speed: 4.8, color: [128,128,128],
      info: { ë°˜ì§€ë¦„: "2,439 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "ê±°ì˜ ì—†ìŒ", ìœ„ì„±: "ì—†ìŒ", ê¸°ì›: "í—¤ë¥´ë©”ìŠ¤", ë°€ë„: "5.43 g/cmÂ³", ì¤‘ë ¥: "3.7 m/sÂ²" }},
    { name: "ê¸ˆì„±", orbit: 120, size: 10, speed: 3.5, color: [255,165,0],
      info: { ë°˜ì§€ë¦„: "6,052 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "CO2", ìœ„ì„±: "ì—†ìŒ", ê¸°ì›: "ë¹„ë„ˆìŠ¤", ë°€ë„: "5.24 g/cmÂ³", ì¤‘ë ¥: "8.87 m/sÂ²" }},
    { name: "ì§€êµ¬", orbit: 160, size: 12, speed: 3, color: [0, 102, 204],
      info: { ë°˜ì§€ë¦„: "6,371 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "ì§ˆì†Œ, ì‚°ì†Œ", ìœ„ì„±: "ë‹¬ 1ê°œ", ê¸°ì›: "Earth", ë°€ë„: "5.51 g/cmÂ³", ì¤‘ë ¥: "9.8 m/sÂ²" },
      moons: [{
        name: "ë‹¬", orbit: 30, size: 3, speed: 15, color: [180,180,180], isMoon: true,
        rotationAngle: random(360), rotationSpeed: 8, // ìœ„ì„± ìì „ ì†ë„
        info: { ë°˜ì§€ë¦„: "1,737 km", ê³µì „ì£¼ê¸°: "27.3ì¼", íŠ¹ì§•: "ì§€êµ¬ì˜ ìœ ì¼í•œ ìì—° ìœ„ì„±", ë°€ë„: "3.34 g/cmÂ³", ì¤‘ë ¥: "1.62 m/sÂ²" }
      }]
    },
    { name: "í™”ì„±", orbit: 200, size: 9, speed: 2.4, color: [204, 0, 0],
      info: { ë°˜ì§€ë¦„: "3,390 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "ì´ì‚°í™”íƒ„ì†Œ", ìœ„ì„±: "2ê°œ", ê¸°ì›: "ë§ˆë¥´ìŠ¤", ë°€ë„: "3.93 g/cmÂ³", ì¤‘ë ¥: "3.71 m/sÂ²" },
      moons: [
        { name: "í¬ë³´ìŠ¤", orbit: 12, size: 1, speed: 20, color: [150,150,150], isMoon: true,
          rotationAngle: random(360), rotationSpeed: 20,
          info: { ë°˜ì§€ë¦„: "11.2 km", ê³µì „ì£¼ê¸°: "0.3ì¼", íŠ¹ì§•: "í™”ì„±ì—ì„œ ê°€ì¥ í° ìœ„ì„±" }},
        { name: "ë°ì´ëª¨ìŠ¤", orbit: 20, size: 0.8, speed: 10, color: [160,160,160], isMoon: true,
          rotationAngle: random(360), rotationSpeed: 10,
          info: { ë°˜ì§€ë¦„: "6.2 km", ê³µì „ì£¼ê¸°: "1.3ì¼", íŠ¹ì§•: "í™”ì„±ì—ì„œ ê°€ì¥ ì‘ì€ ìœ„ì„±" }}
      ]
    },
    { name: "ëª©ì„±", orbit: 250, size: 20, speed: 1.3, color: [255,140,0],
      info: { ë°˜ì§€ë¦„: "69,911 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨", ìœ„ì„±: "92ê°œ", ê¸°ì›: "ì£¼í”¼í„°", ë°€ë„: "1.33 g/cmÂ³", ì¤‘ë ¥: "24.79 m/sÂ²" },
      moons: [
        { name: "ì´ì˜¤", orbit: 38, size: 4, speed: 8, color: [255,200,0], isMoon: true,
          rotationAngle: random(360), rotationSpeed: 8,
          info: { ë°˜ì§€ë¦„: "1,821 km", ê³µì „ì£¼ê¸°: "1.7ì¼", íŠ¹ì§•: "íƒœì–‘ê³„ì—ì„œ ê°€ì¥ í™”ì‚° í™œë™ì´ í™œë°œ" }},
        { name: "ìœ ë¡œíŒŒ", orbit: 48, size: 3.5, speed: 5, color: [150,200,255], isMoon: true,
          rotationAngle: random(360), rotationSpeed: 5,
          info: { ë°˜ì§€ë¦„: "1,560 km", ê³µì „ì£¼ê¸°: "3.5ì¼", íŠ¹ì§•: "ì–¼ìŒ ì§€ê° ì•„ë˜ ì•¡ì²´ ë°”ë‹¤ ì¶”ì •" }},
        { name: "ê°€ë‹ˆë©”ë°", orbit: 60, size: 5, speed: 3, color: [190,190,190], isMoon: true,
          rotationAngle: random(360), rotationSpeed: 3,
          info: { ë°˜ì§€ë¦„: "2,634 km", ê³µì „ì£¼ê¸°: "7.1ì¼", íŠ¹ì§•: "íƒœì–‘ê³„ì—ì„œ ê°€ì¥ í° ìœ„ì„±" }},
        { name: "ì¹¼ë¦¬ìŠ¤í† ", orbit: 75, size: 4.5, speed: 2, color: [170,140,100], isMoon: true,
          rotationAngle: random(360), rotationSpeed: 2,
          info: { ë°˜ì§€ë¦„: "2,410 km", ê³µì „ì£¼ê¸°: "16.7ì¼", íŠ¹ì§•: "ê°€ì¥ ì˜¤ë˜ëœ í‘œë©´ì„ ê°€ì§" }}
      ]
    },
    { name: "í† ì„±", orbit: 300, size: 18, speed: 1.0, color: [240,230,140],
      info: { ë°˜ì§€ë¦„: "58,232 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨", ìœ„ì„±: "83ê°œ", ê¸°ì›: "í¬ë¡œë…¸ìŠ¤", ë°€ë„: "0.687 g/cmÂ³", ì¤‘ë ¥: "10.44 m/sÂ²" },
      moons: [
        { name: "íƒ€ì´íƒ„", orbit: 50, size: 4.8, speed: 6, color: [220,180,100], isMoon: true,
          rotationAngle: random(360), rotationSpeed: 6,
          info: { ë°˜ì§€ë¦„: "2,574 km", ê³µì „ì£¼ê¸°: "16ì¼", íŠ¹ì§•: "ë‘êº¼ìš´ ëŒ€ê¸°ë¥¼ ê°€ì§„ ìœ ì¼í•œ ìœ„ì„±" }},
      ]
    },
    { name: "ì²œì™•ì„±", orbit: 350, size: 16, speed: 0.7, color: [173,216,230],
      info: { ë°˜ì§€ë¦„: "25,362 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨, ë©”íƒ„", ìœ„ì„±: "27ê°œ", ê¸°ì›: "ìš°ë¼ë…¸ìŠ¤", ë°€ë„: "1.27 g/cmÂ³", ì¤‘ë ¥: "8.69 m/sÂ²" }},
    { name: "í•´ì™•ì„±", orbit: 400, size: 15, speed: 0.5, color: [0, 0, 255],
      info: { ë°˜ì§€ë¦„: "24,622 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨, ë©”íƒ„", ìœ„ì„±: "14ê°œ", ê¸°ì›: "ë„µíŠ ", ë°€ë„: "1.64 g/cmÂ³", ì¤‘ë ¥: "11.15 m/sÂ²" }},
    { name: "ëª…ì™•ì„±", orbit: 440, size: 5, speed: 0.3, color: [192,192,192],
      info: { ë°˜ì§€ë¦„: "1,188 km", ì„±ë¶„: "ì–¼ìŒ, ì•”ì„", ëŒ€ê¸°: "ì§ˆì†Œ, ë©”íƒ„", ìœ„ì„±: "5ê°œ", ê¸°ì›: "í”Œë£¨í† ", ë¶„ë¥˜: "ì™œì†Œí–‰ì„±", ë°€ë„: "1.85 g/cmÂ³", ì¤‘ë ¥: "0.62 m/sÂ²" }},
  ];

  for (let p of data) {
    p.angle = random(360);
    p.rotationAngle = random(360); // ì´ˆê¸° ìì „ ê°ë„
    p.rotationSpeed = random(0.5, 2); // ìì „ ì†ë„ (í–‰ì„±ë§ˆë‹¤ ë‹¤ë¥´ê²Œ)
    if (p.moons) {
        for (let m of p.moons) {
            m.angle = random(360);
            m.rotationAngle = random(360); // ìœ„ì„± ì´ˆê¸° ìì „ ê°ë„
            // ìœ„ì„±ë§ˆë‹¤ ìì „ ì†ë„ê°€ ë‹¤ë¥´ë„ë¡ (ì´ë¯¸ ë°ì´í„°ì— í¬í•¨ëœ ê²½ìš°ë„ ìˆìŒ)
            if (m.rotationSpeed === undefined) {
              m.rotationSpeed = random(5, 15);
            }
        }
    }
    planets.push(p);
  }
}

function generateStars() {
  stars = [];
  for (let i = 0; i < 400; i++) {
    stars.push({
      x: random(width),
      y: random(height),
      baseBrightness: random(180, 255),
      twinkle: random(0.01, 0.05),
      phase: random(TWO_PI)
    });
  }
}

function drawStars() {
  noStroke();
  for (let s of stars) {
    let flicker = sin(frameCount * s.twinkle + s.phase) * 30;
    let b = constrain(s.baseBrightness + flicker, 180, 255);
    fill(b);
    ellipse(s.x, s.y, 1.5);
  }
}

function mousePressed() {
  if (checkInfoBoxHit(mouseX, mouseY) || draggingInfo) {
    return;
  }
  handleClick(mouseX, mouseY);
}
function touchStarted() {
  if (checkInfoBoxHit(touchX, touchY) || draggingInfo) {
    return false;
  }
  handleClick(touchX, touchY);
  return false;
}

function handleClick(x, y) {
  let mx = (x - (width / 2 + camX * zoom)) / zoom;
  let my = (y - (height / 2 + camY * zoom)) / zoom;

  let clickedSomething = false;

  // ìœ„ì„± í´ë¦­ ê°ì§€ ë¨¼ì € (ìœ„ì„±ì´ í–‰ì„±ë³´ë‹¤ ì‘ì•„ ë¨¼ì € ê°ì§€í•´ì•¼ í•¨)
  for (let p of planets) {
    if (p.moons) {
      for (let m of p.moons) {
        // ìœ„ì„±ì˜ ì ˆëŒ€ ìœ„ì¹˜
        let moonX = p.x + cos(m.angle) * m.orbit;
        let moonY = p.y + sin(m.angle) * m.orbit;
        if (dist(mx, my, moonX, moonY) < m.size * 2 / (zoom / defaultZoom)) {
          if (selectedPlanet === m) {
            closeInfoBox();
          } else {
            selectedPlanet = m;
            showInfoBox(m);
            isFollowingPlanet = false; // ìœ„ì„±ì€ ì¹´ë©”ë¼ íŒ”ë¡œìš° í•˜ì§€ ì•ŠìŒ
            if (planetSearchInput) {
                planetSearchInput.value = m.name;
            }
          }
          clickedSomething = true;
          break;
        }
      }
    }
    if (clickedSomething) break;
  }

  // ìœ„ì„±ì„ í´ë¦­í•˜ì§€ ì•Šì•˜ë‹¤ë©´ í–‰ì„± í´ë¦­ ê°ì§€
  if (!clickedSomething) {
    for (let p of planets) {
      if (dist(mx, my, p.x, p.y) < p.size * 1.5 / (zoom / defaultZoom)) {
        if (selectedPlanet === p) {
          closeInfoBox();
        } else {
          selectedPlanet = p;
          showInfoBox(p);
          isFollowingPlanet = true; // í–‰ì„±ì€ ì¹´ë©”ë¼ íŒ”ë¡œìš°
          if (planetSearchInput) {
              planetSearchInput.value = p.name;
          }
        }
        clickedSomething = true;
        break;
      }
    }
  }

  // ì•„ë¬´ê²ƒë„ í´ë¦­í•˜ì§€ ì•Šì•˜ê³ , ì´ì „ì— ì„ íƒëœ ê²ƒì´ ìˆì—ˆë‹¤ë©´ ì •ë³´ì°½ ë‹«ê¸°
  if (!clickedSomething && selectedPlanet) {
    closeInfoBox();
  }
}

function showInfoBox(obj) {
  if (!obj) return;
  infoContent.innerHTML = "";
  let keys = Object.keys(obj.info);
  for (let k of keys) {
    let li = document.createElement('li');
    li.textContent = `${k}: ${obj.info[k]}`;
    infoContent.appendChild(li);
  }
  let typePrefix = obj.isMoon ? "ğŸ›°ï¸ " : "ğŸŒ ";
  infoBox.querySelector('h2').textContent = `${typePrefix}${obj.name} ì •ë³´`;
  infoBox.classList.add('show');
  infoBox.style.left = infoBoxX + 'px';
  infoBox.style.top = infoBoxY + 'px';
}

function closeInfoBox() {
  selectedPlanet = null;
  infoBox.classList.remove('show');
  isFollowingPlanet = false;
  if (planetSearchInput) {
      planetSearchInput.value = '';
  }
}

function infoMouseDown(e) {
  e.preventDefault();
  draggingInfo = true;
  dragOffsetX = e.clientX - infoBox.offsetLeft;
  dragOffsetY = e.clientY - infoBox.offsetTop;
}
function infoMouseMove(e) {
  if (!draggingInfo) return;
  e.preventDefault();
  infoBoxX = e.clientX - dragOffsetX;
  infoBoxY = e.clientY - dragOffsetY;
  infoBox.style.left = infoBoxX + 'px';
  infoBox.style.top = infoBoxY + 'px';
}
function infoMouseUp(e) {
  draggingInfo = false;
}

function infoTouchStart(e) {
  if (e.touches.length !== 1) return;
  e.preventDefault();
  draggingInfo = true;
  let touch = e.touches[0];
  dragOffsetX = touch.clientX - infoBox.offsetLeft;
  dragOffsetY = touch.clientY - infoBox.offsetTop;
}
function infoTouchMove(e) {
  if (!draggingInfo) return;
  e.preventDefault();
  let touch = e.touches[0];
  infoBoxX = touch.clientX - dragOffsetX;
  infoBoxY = touch.clientY - dragOffsetY;
  infoBox.style.left = infoBoxX + 'px';
  infoBox.style.top = infoBoxY + 'px';
}
function infoTouchEnd(e) {
  draggingInfo = false;
}

function togglePause() {
  isPaused = !isPaused;
  document.getElementById("pauseBtn").textContent = isPaused ? "â–¶ ì¬ìƒ" : "â¸ ì •ì§€";
}

function adjustSpeed(delta) {
  displaySpeed = constrain(displaySpeed + delta, 0.1, maxDisplaySpeed);
  updateSpeedDisplay();
}

function updateSpeedDisplay() {
  speedDisplay.textContent = `ë°°ì†: x${displaySpeed.toFixed(1)}`;
}

function setZoom(val) {
  defaultZoom = constrain(val, 0.5, 2);
  document.getElementById("zoomSlider").value = defaultZoom;
  if (!isFollowingPlanet) {
      zoom = defaultZoom;
  }
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}

function checkInfoBoxHit(x, y) {
  if (!infoBox.classList.contains('show')) return false;

  let rectLeft = infoBoxX;
  let rectTop = infoBoxY;
  let rectRight = rectLeft + infoBox.offsetWidth;
  let rectBottom = rectTop + infoBox.offsetHeight;
  return (x >= rectLeft && x <= rectRight && y >= rectTop && y <= rectBottom);
}
</script>
</body>
</html>
