<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>íƒœì–‘ê³„ ì‹œë®¬ë ˆì´ì…˜</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body {
      margin: 0; overflow: hidden;
      background: black;
      color: white;
      font-family: 'Noto Sans', sans-serif, sans-serif;
      -webkit-user-select:none;
      -moz-user-select:none;
      -ms-user-select:none;
      user-select:none;
    }
    .ui-button {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 1000;
    }
    .ui-button button {
      padding: 10px 16px;
      font-size: 14px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      background: #eee;
      cursor: pointer;
      transition: background 0.2s;
      user-select:none;
    }
    .ui-button button:hover {
      background: #ccc;
    }
    .zoom-control {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1000;
      background: rgba(255,255,255,0.85);
      padding: 10px;
      border-radius: 10px;
      user-select:none;
    }
    .zoom-control button {
      margin: 4px 0;
      width: 36px;
      height: 36px;
      font-size: 20px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
    }
    .zoom-control input[type="range"] {
      writing-mode: bt-lr;
      -webkit-appearance: slider-vertical;
      width: 30px;
      height: 130px;
      margin: 8px 0;
    }
    /* ì •ë³´ì°½ ìŠ¤íƒ€ì¼ */
    #infoBox {
      position: fixed;
      top: 60px;
      left: 20px;
      width: 240px;
      background: rgba(255,255,255,0.95);
      color: black;
      border-radius: 10px;
      padding: 12px 16px 16px 16px;
      box-shadow: 0 0 15px rgba(255,255,255,0.3);
      user-select:none;
      cursor: default;
      z-index: 1100;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    #infoBox.show {
      opacity: 1;
      visibility: visible;
    }
    #infoBox h2 {
      margin: 0 0 8px 0;
      font-weight: 700;
      font-size: 18px;
    }
    #infoBox ul {
      padding-left: 18px;
      margin: 0;
      font-size: 14px;
      line-height: 1.3;
    }
    #infoBox ul li {
      margin-bottom: 6px;
    }
    #closeBtn {
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 20px;
      font-weight: bold;
      color: #444;
      cursor: pointer;
      user-select:none;
      transition: color 0.2s;
    }
    #closeBtn:hover {
      color: #000;
    }
    /* ë°°ì† í‘œì‹œ ìŠ¤íƒ€ì¼ (ë…ë¦½) */
    #speedDisplay {
      position: fixed; /* ë…ë¦½ì ì¸ ìœ„ì¹˜ ì„¤ì • */
      top: 20px; /* ìƒë‹¨ì—ì„œ 20px */
      right: 20px; /* ì˜¤ë¥¸ìª½ì—ì„œ 20px */
      font-size: 14px;
      font-weight: bold;
      color: #333;
      background: rgba(255,255,255,0.85); /* ì¤Œ ì»¨íŠ¸ë¡¤ê³¼ ìœ ì‚¬í•œ ë°°ê²½ */
      padding: 6px 10px;
      border-radius: 5px;
      text-align: center;
      width: 80px;
      z-index: 1000; /* ë‹¤ë¥¸ UI ìš”ì†Œ ìœ„ì— í‘œì‹œ */
    }
  </style>
</head>
<body>

<div class="ui-button">
  <button id="pauseBtn">â¸ ì •ì§€</button>
  <button id="slowBtn">ëŠë¦¬ê²Œ</button>
  <button id="fastBtn">ë¹ ë¥´ê²Œ</button>
</div>

<div class="zoom-control">
  <button id="zoomInBtn">ï¼‹</button>
  <input type="range" min="0.5" max="2" step="0.01" value="1" id="zoomSlider" />
  <button id="zoomOutBtn">âˆ’</button>
</div>

<span id="speedDisplay">ë°°ì†: x1.0</span>

<div id="infoBox">
  <span id="closeBtn">Ã—</span>
  <h2>í–‰ì„± ì •ë³´</h2>
  <ul id="infoContent"></ul>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<script>
let planets = [];
let stars = [];
let selectedPlanet = null;
let baseSpeed = 0.5;
let displaySpeed = 1;
let maxDisplaySpeed = 4;
let currentSpeed = baseSpeed;
let isPaused = false;
let zoom = 1;

let infoBox = null;
let infoContent = null;
let speedDisplay = null;
let infoBoxX = 20, infoBoxY = 60;
let draggingInfo = false;
let dragOffsetX = 0, dragOffsetY = 0;

function setup() {
  createCanvas(windowWidth, windowHeight);
  angleMode(DEGREES);
  initPlanets();
  generateStars();

  infoBox = document.getElementById('infoBox');
  infoContent = document.getElementById('infoContent');
  speedDisplay = document.getElementById('speedDisplay');

  // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
  document.getElementById('pauseBtn').addEventListener('click', togglePause);
  document.getElementById('slowBtn').addEventListener('click', () => adjustSpeed(-0.1));
  document.getElementById('fastBtn').addEventListener('click', () => adjustSpeed(0.1));
  document.getElementById('zoomInBtn').addEventListener('click', () => setZoom(zoom * 1.1));
  document.getElementById('zoomOutBtn').addEventListener('click', () => setZoom(zoom / 1.1));
  document.getElementById('zoomSlider').addEventListener('input', (e) => setZoom(parseFloat(e.target.value)));
  document.getElementById('closeBtn').addEventListener('click', closeInfoBox);

  // ë“œë˜ê·¸ ì‹œì‘
  infoBox.addEventListener('mousedown', infoMouseDown);
  window.addEventListener('mouseup', infoMouseUp);
  window.addEventListener('mousemove', infoMouseMove);

  // í„°ì¹˜ ì§€ì›
  infoBox.addEventListener('touchstart', infoTouchStart, {passive: false});
  window.addEventListener('touchend', infoTouchEnd);
  window.addEventListener('touchmove', infoTouchMove, {passive: false});

  updateSpeedDisplay(); // ì´ˆê¸° ë°°ì† í‘œì‹œ
}

function draw() {
  background(0);
  drawStars();

  translate(width / 2, height / 2);
  scale(zoom);

  let targetSpeed = isPaused ? 0 : baseSpeed * displaySpeed;
  currentSpeed = lerp(currentSpeed, targetSpeed, 0.05);

  noFill();
  stroke(100, 150);
  strokeWeight(1);
  for (let p of planets) {
    if (p.orbit > 0) ellipse(0, 0, p.orbit * 2);
  }

  for (let p of planets) {
    if (p.orbit > 0) p.angle += p.speed * currentSpeed;
    let x = p.orbit === 0 ? 0 : cos(p.angle) * p.orbit;
    let y = p.orbit === 0 ? 0 : sin(p.angle) * p.orbit;
    p.x = x;
    p.y = y;

    // í• ë¡œ íš¨ê³¼
    noStroke();
    for(let i=0; i<5; i++) {
      fill(p.color[0], p.color[1], p.color[2], 80 - i*15);
      ellipse(x, y, p.size*2 + i*10);
    }

    fill(p.color[0], p.color[1], p.color[2]);
    ellipse(x, y, p.size * 2);

    fill(255);
    stroke(0);
    strokeWeight(3);
    textSize(12 / zoom);
    textAlign(CENTER);
    text(p.name, x, y - p.size - 8);
    noStroke();
  }

  // ì •ë³´ì°½ ë“œë˜ê·¸ì¤‘ì´ë¼ë©´ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ (ì„ íƒëœ í–‰ì„± ìˆìŒ)
  if (infoBox.classList.contains('show')) {
      infoBox.style.left = infoBoxX + 'px';
      infoBox.style.top = infoBoxY + 'px';
  }
}

function initPlanets() {
  planets = [];
  // íƒœì–‘ (ì¤‘ì‹¬)
  planets.push({
    name: "íƒœì–‘", orbit: 0, size: 50, speed: 0, angle: 0,
    color: [255, 220, 0],
    info: {
      ë°˜ì§€ë¦„: "696,340 km",
      ì„±ë¶„: "ìˆ˜ì†Œ, í—¬ë¥¨",
      ëŒ€ê¸°: "ìˆìŒ",
      ìœ„ì„±: "ì—†ìŒ",
      ê¸°ì›: "Sol"
    }
  });

  const data = [
    { name: "ìˆ˜ì„±", orbit: 90, size: 6, speed: 4.8, color: [128,128,128], info: { ë°˜ì§€ë¦„: "2,439 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "ê±°ì˜ ì—†ìŒ", ìœ„ì„±: "ì—†ìŒ", ê¸°ì›: "í—¤ë¥´ë©”ìŠ¤" }},
    { name: "ê¸ˆì„±", orbit: 120, size: 10, speed: 3.5, color: [255,165,0], info: { ë°˜ì§€ë¦„: "6,052 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "CO2", ìœ„ì„±: "ì—†ìŒ", ê¸°ì›: "ë¹„ë„ˆìŠ¤" }},
    { name: "ì§€êµ¬", orbit: 160, size: 12, speed: 3, color: [0, 102, 204], info: { ë°˜ì§€ë¦„: "6,371 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "ì§ˆì†Œ, ì‚°ì†Œ", ìœ„ì„±: "ë‹¬ 1ê°œ", ê¸°ì›: "Earth" }},
    { name: "í™”ì„±", orbit: 200, size: 9, speed: 2.4, color: [204, 0, 0], info: { ë°˜ì§€ë¦„: "3,390 km", ì„±ë¶„: "ì•”ì„", ëŒ€ê¸°: "ì´ì‚°í™”íƒ„ì†Œ", ìœ„ì„±: "2ê°œ", ê¸°ì›: "ë§ˆë¥´ìŠ¤" }},
    { name: "ëª©ì„±", orbit: 250, size: 20, speed: 1.3, color: [255,140,0], info: { ë°˜ì§€ë¦„: "69,911 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨", ìœ„ì„±: "92ê°œ", ê¸°ì›: "ì£¼í”¼í„°" }},
    { name: "í† ì„±", orbit: 300, size: 18, speed: 1.0, color: [240,230,140], info: { ë°˜ì§€ë¦„: "58,232 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨", ìœ„ì„±: "83ê°œ", ê¸°ì›: "í¬ë¡œë…¸ìŠ¤" }},
    { name: "ì²œì™•ì„±", orbit: 350, size: 16, speed: 0.7, color: [173,216,230], info: { ë°˜ì§€ë¦„: "25,362 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨, ë©”íƒ„", ìœ„ì„±: "27ê°œ", ê¸°ì›: "ìš°ë¼ë…¸ìŠ¤" }},
    { name: "í•´ì™•ì„±", orbit: 400, size: 15, speed: 0.5, color: [0, 0, 255], info: { ë°˜ì§€ë¦„: "24,622 km", ì„±ë¶„: "ê°€ìŠ¤", ëŒ€ê¸°: "ìˆ˜ì†Œ, í—¬ë¥¨, ë©”íƒ„", ìœ„ì„±: "14ê°œ", ê¸°ì›: "ë„µíŠ " }},
    { name: "ëª…ì™•ì„±", orbit: 440, size: 5, speed: 0.3, color: [192,192,192], info: { ë°˜ì§€ë¦„: "1,188 km", ì„±ë¶„: "ì–¼ìŒ, ì•”ì„", ëŒ€ê¸°: "ì§ˆì†Œ, ë©”íƒ„", ìœ„ì„±: "5ê°œ", ê¸°ì›: "í”Œë£¨í† ", ë¶„ë¥˜: "ì™œì†Œí–‰ì„±" }},
  ];

  for (let p of data) {
    p.angle = random(360);
    planets.push(p);
  }
}

function generateStars() {
  stars = [];
  for (let i = 0; i < 400; i++) {
    stars.push({
      x: random(width),
      y: random(height),
      baseBrightness: random(180, 255),
      twinkle: random(0.01, 0.05),
      phase: random(TWO_PI)
    });
  }
}

function drawStars() {
  noStroke();
  for (let s of stars) {
    let flicker = sin(frameCount * s.twinkle + s.phase) * 30;
    let b = constrain(s.baseBrightness + flicker, 180, 255);
    fill(b);
    ellipse(s.x, s.y, 1.5);
  }
}

// í´ë¦­ / í„°ì¹˜ ì´ë²¤íŠ¸ë¡œ í–‰ì„± ì„ íƒ ë° ì •ë³´ì°½ ì¶œë ¥
function mousePressed() {
  if (checkInfoBoxHit(mouseX, mouseY)) {
    return;
  }
  handleClick(mouseX, mouseY);
}
function touchStarted() {
  if (checkInfoBoxHit(touchX, touchY)) {
    return false;
  }
  handleClick(touchX, touchY);
  return false;
}

function handleClick(x, y) {
  let mx = (x - width / 2) / zoom;
  let my = (y - height / 2) / zoom;

  // í–‰ì„± í´ë¦­ ê°ì§€
  for (let p of planets) {
    if (dist(mx, my, p.x, p.y) < p.size * 1.5) {
      if (selectedPlanet === p) {
        closeInfoBox();
      } else {
        selectedPlanet = p;
        showInfoBox(p);
      }
      return;
    }
  }

  // í–‰ì„± ì™¸ í´ë¦­ì‹œ ì •ë³´ì°½ ë‹«ê¸°
  if (selectedPlanet) closeInfoBox();
}

function showInfoBox(planet) {
  if (!planet) return;
  infoContent.innerHTML = "";
  let keys = Object.keys(planet.info);
  for (let k of keys) {
    let li = document.createElement('li');
    li.textContent = `${k}: ${planet.info[k]}`;
    infoContent.appendChild(li);
  }
  infoBox.querySelector('h2').textContent = `ğŸŒ ${planet.name} ì •ë³´`;
  infoBox.classList.add('show');
  infoBox.style.left = infoBoxX + 'px';
  infoBox.style.top = infoBoxY + 'px';
  selectedPlanet = planet;
}

function closeInfoBox() {
  selectedPlanet = null;
  infoBox.classList.remove('show');
}

// ë“œë˜ê·¸ ì‹œì‘
function infoMouseDown(e) {
  e.preventDefault();
  draggingInfo = true;
  dragOffsetX = e.clientX - infoBox.offsetLeft;
  dragOffsetY = e.clientY - infoBox.offsetTop;
}
// ë“œë˜ê·¸ ì¤‘
function infoMouseMove(e) {
  if (!draggingInfo) return;
  e.preventDefault();
  infoBoxX = e.clientX - dragOffsetX;
  infoBoxY = e.clientY - dragOffsetY;
  infoBox.style.left = infoBoxX + 'px';
  infoBox.style.top = infoBoxY + 'px';
}
// ë“œë˜ê·¸ ë
function infoMouseUp(e) {
  draggingInfo = false;
}

// í„°ì¹˜ ë“œë˜ê·¸ ì‹œì‘
function infoTouchStart(e) {
  if (e.touches.length !== 1) return;
  e.preventDefault();
  draggingInfo = true;
  let touch = e.touches[0];
  dragOffsetX = touch.clientX - infoBox.offsetLeft;
  dragOffsetY = touch.clientY - infoBox.offsetTop;
}
// í„°ì¹˜ ë“œë˜ê·¸ ì¤‘
function infoTouchMove(e) {
  if (!draggingInfo) return;
  e.preventDefault();
  let touch = e.touches[0];
  infoBoxX = touch.clientX - dragOffsetX;
  infoBoxY = touch.clientY - dragOffsetY;
  infoBox.style.left = infoBoxX + 'px';
  infoBox.style.top = infoBoxY + 'px';
}
// í„°ì¹˜ ë“œë˜ê·¸ ë
function infoTouchEnd(e) {
  draggingInfo = false;
}

function togglePause() {
  isPaused = !isPaused;
  document.getElementById("pauseBtn").textContent = isPaused ? "â–¶ ì¬ìƒ" : "â¸ ì •ì§€";
}

function adjustSpeed(delta) {
  displaySpeed = constrain(displaySpeed + delta, 0.1, maxDisplaySpeed);
  updateSpeedDisplay(); // ì†ë„ ì¡°ì ˆ í›„ ë°°ì† í‘œì‹œ ì—…ë°ì´íŠ¸
}

function updateSpeedDisplay() {
  speedDisplay.textContent = `ë°°ì†: x${displaySpeed.toFixed(1)}`; // ì†Œìˆ˜ì  ì²«ì§¸ìë¦¬ê¹Œì§€ í‘œì‹œ
}

function setZoom(val) {
  zoom = constrain(val, 0.5, 2);
  document.getElementById("zoomSlider").value = zoom;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}

function checkInfoBoxHit(x, y) {
  if (!selectedPlanet) return false;
  let rectLeft = infoBoxX;
  let rectTop = infoBoxY;
  let rectRight = rectLeft + infoBox.offsetWidth;
  let rectBottom = rectTop + infoBox.offsetHeight;
  return (x >= rectLeft && x <= rectRight && y >= rectTop && y <= rectBottom);
}
</script>
</body>
</html>
